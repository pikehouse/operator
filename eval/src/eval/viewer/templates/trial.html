{% extends "base.html" %}

{% block title %}Trial {{ trial.id }} - Eval Viewer{% endblock %}

{% block content %}
<div class="mb-4">
    <a href="/campaign/{{ trial.campaign_id }}" class="text-blue-600 hover:underline text-sm">&larr; Back to campaign</a>
</div>

<h1 class="text-2xl font-bold mb-4">Trial {{ trial.id }}</h1>

<div class="bg-white shadow rounded p-4 mb-4">
    <h2 class="text-lg font-semibold mb-2">Timing</h2>
    <dl class="grid grid-cols-2 gap-2 text-sm">
        <dt class="text-gray-500">Started:</dt>
        <dd>{{ trial.started_at }}</dd>
        <dt class="text-gray-500">Chaos Injected:</dt>
        <dd>{{ trial.chaos_injected_at }}</dd>
        <dt class="text-gray-500">Ticket Created:</dt>
        <dd>{{ trial.ticket_created_at if trial.ticket_created_at else "N/A" }}</dd>
        <dt class="text-gray-500">Resolved:</dt>
        <dd>
            {% if trial.resolved_at %}
            <span class="text-green-600">{{ trial.resolved_at }}</span>
            {% else %}
            <span class="text-red-600">Not resolved</span>
            {% endif %}
        </dd>
        <dt class="text-gray-500">Ended:</dt>
        <dd>{{ trial.ended_at }}</dd>
    </dl>
</div>

<div class="bg-white shadow rounded p-4 mb-4">
    <h2 class="text-lg font-semibold mb-2">Commands ({{ commands|length }})</h2>
    {% if commands %}
    <div class="space-y-2">
        {% for cmd in commands %}
        <div class="bg-gray-50 p-2 rounded font-mono text-sm overflow-x-auto">
            {% if cmd is string %}
            {{ cmd }}
            {% else %}
            {{ cmd.command if cmd.command else cmd }}
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p class="text-gray-500">No commands recorded.</p>
    {% endif %}
</div>

{% if reasoning_entries %}
<div class="bg-white shadow rounded p-4 mb-4">
    <h2 class="text-lg font-semibold mb-4">Agent Reasoning Timeline</h2>
    <div class="space-y-2">
        {% for entry in reasoning_entries %}
        <div class="{% if entry.entry_type == 'reasoning' %}bg-blue-50 border-l-4 border-blue-400{% elif entry.entry_type == 'tool_call' %}bg-yellow-50 border-l-4 border-yellow-400{% else %}bg-green-50 border-l-4 border-green-400{% endif %} p-3 rounded-r">
            <div class="flex justify-between items-start mb-1">
                <span class="text-xs font-medium uppercase tracking-wide {% if entry.entry_type == 'reasoning' %}text-blue-600{% elif entry.entry_type == 'tool_call' %}text-yellow-600{% else %}text-green-600{% endif %}">
                    {{ entry.entry_type }}
                </span>
                <span class="text-xs text-gray-500">{{ entry.timestamp }}</span>
            </div>
            {% if entry.tool_name %}
            <div class="font-mono text-sm text-gray-700 mb-1">{{ entry.tool_name }}</div>
            {% endif %}
            <div class="text-sm text-gray-800 whitespace-pre-wrap">{{ entry.content }}</div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}
{% endblock %}
