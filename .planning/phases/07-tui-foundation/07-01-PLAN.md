---
phase: 07-tui-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/operator-core/src/operator_core/tui/__init__.py
  - packages/operator-core/src/operator_core/tui/buffer.py
  - packages/operator-core/src/operator_core/tui/layout.py
autonomous: true

must_haves:
  truths:
    - "OutputBuffer stores lines with automatic oldest-removal when full"
    - "Layout displays 5 distinct panels (cluster, monitor, agent, workload, narration)"
    - "Panel sizes are configured (cluster=35 cols fixed, narration=5 rows, workload=8 rows, monitor/agent flex)"
  artifacts:
    - path: "packages/operator-core/src/operator_core/tui/__init__.py"
      provides: "TUI module exports"
      exports: ["OutputBuffer", "create_layout", "make_panel"]
    - path: "packages/operator-core/src/operator_core/tui/buffer.py"
      provides: "Ring buffer for daemon output"
      contains: "class OutputBuffer"
    - path: "packages/operator-core/src/operator_core/tui/layout.py"
      provides: "5-panel layout factory"
      contains: "def create_layout"
  key_links:
    - from: "packages/operator-core/src/operator_core/tui/__init__.py"
      to: "buffer.py, layout.py"
      via: "re-exports"
      pattern: "from operator_core.tui.(buffer|layout) import"
---

<objective>
Create TUI module foundation with OutputBuffer and 5-panel layout factory.

Purpose: Establishes the core building blocks for the TUI - a ring buffer for capturing daemon output and a layout factory that creates the 5-panel dashboard structure. These are independent components that the TUIController will compose in plan 02.

Output:
- `tui/__init__.py` with public exports
- `tui/buffer.py` with OutputBuffer class (deque-based ring buffer)
- `tui/layout.py` with create_layout() and make_panel() functions
</objective>

<execution_context>
@/Users/jrtipton/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jrtipton/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-tui-foundation/07-RESEARCH.md

# Existing patterns to follow
@packages/operator-core/src/operator_core/__init__.py
@packages/operator-core/src/operator_core/monitor/loop.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create OutputBuffer class</name>
  <files>
    packages/operator-core/src/operator_core/tui/__init__.py
    packages/operator-core/src/operator_core/tui/buffer.py
  </files>
  <action>
Create the TUI module directory and implement OutputBuffer:

1. Create `tui/__init__.py` with placeholder exports (will be updated in Task 2)

2. Create `tui/buffer.py` with OutputBuffer class per RESEARCH.md Pattern 3:
   - Use `collections.deque(maxlen=N)` for automatic oldest-removal
   - Constructor takes `maxlen: int = 50` parameter
   - `append(line: str)` - add line, strip trailing newline
   - `get_lines(n: int | None = None) -> list[str]` - get last n lines or all
   - `get_text(n: int | None = None) -> str` - get lines as newline-joined string
   - `__len__()` - return number of lines
   - `__iter__()` - iterate over lines
   - `clear()` - clear all lines

Add docstrings following existing codebase style (see monitor/loop.py).

DO NOT use typing.Iterator - use collections.abc.Iterator (Python 3.9+ style).
  </action>
  <verify>
Run: `cd /Users/jrtipton/x/operator && python -c "from operator_core.tui.buffer import OutputBuffer; b = OutputBuffer(maxlen=3); b.append('a'); b.append('b'); b.append('c'); b.append('d'); print(b.get_lines())"`

Expected output: `['b', 'c', 'd']` (oldest 'a' was removed)
  </verify>
  <done>
OutputBuffer class exists, imports successfully, ring buffer behavior works (oldest line removed when full).
  </done>
</task>

<task type="auto">
  <name>Task 2: Create 5-panel layout factory</name>
  <files>
    packages/operator-core/src/operator_core/tui/layout.py
    packages/operator-core/src/operator_core/tui/__init__.py
  </files>
  <action>
Create layout factory per RESEARCH.md Pattern 1 and code example:

1. Create `tui/layout.py` with:

`create_layout() -> Layout`:
```
+------------------+----------------------------------------+
|                  |  Narration (5 rows fixed)              |
|  Cluster Status  +----------------------------------------+
|  (35 cols fixed) |  Monitor Output (ratio=1, flex)        |
|                  +----------------------------------------+
|                  |  Agent Output (ratio=1, flex)          |
|                  +----------------------------------------+
|                  |  Workload (8 rows fixed)               |
+------------------+----------------------------------------+
```

Implementation:
- Create root Layout named "root"
- `split_row()` into "cluster" (size=35) and "main"
- `layout["main"].split_column()` into:
  - "narration" (size=5)
  - "monitor" (ratio=1)
  - "agent" (ratio=1)
  - "workload" (size=8)

`make_panel(content: str, title: str, style: str = "blue") -> Panel`:
- Create Panel with content, title formatted as `[bold]{title}[/bold]`
- Set border_style to style parameter
- Set padding=(0, 1)

2. Update `tui/__init__.py` to export:
- OutputBuffer from buffer
- create_layout, make_panel from layout
- Add `__all__` list

Follow existing codebase docstring conventions.
  </action>
  <verify>
Run: `cd /Users/jrtipton/x/operator && python -c "from operator_core.tui import create_layout, make_panel; layout = create_layout(); print([name for name in ['cluster', 'narration', 'monitor', 'agent', 'workload'] if name in str(layout)])"`

Expected output: `['cluster', 'narration', 'monitor', 'agent', 'workload']` (all 5 panel names present)
  </verify>
  <done>
Layout factory creates 5-panel structure with correct names and sizes. make_panel creates styled panels. All exports available from `operator_core.tui`.
  </done>
</task>

</tasks>

<verification>
After both tasks:

1. Module imports cleanly:
```bash
cd /Users/jrtipton/x/operator && python -c "from operator_core.tui import OutputBuffer, create_layout, make_panel; print('All imports OK')"
```

2. OutputBuffer ring buffer works:
```bash
cd /Users/jrtipton/x/operator && python -c "
from operator_core.tui import OutputBuffer
b = OutputBuffer(maxlen=5)
for i in range(10):
    b.append(f'line {i}')
assert len(b) == 5
assert b.get_lines() == ['line 5', 'line 6', 'line 7', 'line 8', 'line 9']
print('OutputBuffer OK')
"
```

3. Layout has correct structure:
```bash
cd /Users/jrtipton/x/operator && python -c "
from operator_core.tui import create_layout
layout = create_layout()
# Verify all panels exist by accessing them
_ = layout['cluster']
_ = layout['main']['narration']
_ = layout['main']['monitor']
_ = layout['main']['agent']
_ = layout['main']['workload']
print('Layout structure OK')
"
```
</verification>

<success_criteria>
- [ ] OutputBuffer class implements ring buffer with deque(maxlen=N)
- [ ] create_layout() returns 5-panel Layout with correct names
- [ ] make_panel() creates styled Panel objects
- [ ] All three functions exported from operator_core.tui
- [ ] All verification commands pass
</success_criteria>

<output>
After completion, create `.planning/phases/07-tui-foundation/07-01-SUMMARY.md`
</output>
