# Milestone v3.1: Demo Update

**Status:** âœ… SHIPPED 2026-01-29
**Phases:** 33-34
**Total Plans:** 5

## Overview

Fix TUI demo to work with v3.0 agent_lab architecture. Both TiKV and ratelimiter demos run end-to-end with autonomous agent diagnosis and remediation.

## Phases

### Phase 33: Agent Database Integration

**Goal**: Agent subprocess handles database lifecycle correctly
**Depends on**: Phase 32
**Plans**: 3 plans

Plans:
- [x] 33-01-PLAN.md - Create TicketOpsDB context manager with schema initialization
- [x] 33-02-PLAN.md - Add signal handling to agent loop with graceful shutdown
- [x] 33-03-PLAN.md - Unit tests for schema initialization (TEST-03)

**Success Criteria:**
1. Agent subprocess initializes schema on first connection (no "no such table" errors)
2. Agent poll loop runs without errors when database is empty (no tickets yet)
3. Demo script starts with clean database state (repeatable demo runs)
4. Agent subprocess handles SIGTERM gracefully (marks session as escalated, cleans up)
5. Agent code (operator_core) contains no demo-specific logic (clean separation of concerns)
6. Unit test verifies agent schema initialization works correctly

### Phase 34: Demo End-to-End Validation

**Goal**: Both demos run successfully with v3.0 agent
**Depends on**: Phase 33
**Plans**: 2 plans (validated ad-hoc)

Plans:
- [x] 34-01-PLAN.md - Manual validation of TiKV and rate limiter demos (DEMO-04, DEMO-05, DEMO-06)
- [x] 34-02-PLAN.md - Create pytest integration tests (TEST-01, TEST-02)

**Success Criteria:**
1. TiKV demo completes full flow: startup -> fault injection -> agent diagnosis -> autonomous resolution
2. Rate limiter demo completes full flow: startup -> fault injection -> agent diagnosis -> autonomous resolution
3. Agent panel displays subprocess output in real-time (verify existing TUI behavior)
4. Demo chapters advance correctly with proper timing and state transitions
5. Integration tests verify TiKV demo runs without errors
6. Integration tests verify ratelimiter demo runs without errors

---

## Milestone Summary

**Key Decisions:**
- Follow AuditLogDB pattern for TicketOpsDB (consistency across codebase)
- Make get_counter() read-only using zcount (prevent counter pruning)
- Add baseline heartbeat to keep counters alive during demo
- Sort over-limit counters first in workload panel

**Issues Resolved:**
- "no such table: tickets" errors on fresh database
- Ratelimiter counters disappearing during demo (multiple root causes fixed)
- Chaos key not visible until after injection

**Issues Deferred:**
- Formal integration tests (manual validation sufficient for now)

**Technical Debt Incurred:**
- Phase 34 validated ad-hoc rather than through formal plan execution

---

*For current project status, see .planning/ROADMAP.md*
