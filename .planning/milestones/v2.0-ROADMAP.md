# Milestone v2.0: Agent Actions

**Status:** SHIPPED 2026-01-26
**Phases:** 12-15
**Total Plans:** 12

## Overview

Enable the agent to execute its recommendations, not just observe and diagnose. Four phases deliver action execution with safety-first architecture.

## Phases

### Phase 12: Action Foundation

**Goal**: Infrastructure exists for proposing, validating, executing, and auditing actions safely.
**Depends on**: None (first phase of v2.0)
**Plans**: 4 plans

Plans:
- [x] 12-01-PLAN.md — Action types and database schema
- [x] 12-02-PLAN.md — Action registry and parameter validation
- [x] 12-03-PLAN.md — Safety controls and audit logging
- [x] 12-04-PLAN.md — Agent integration and CLI commands

**Requirements:**
- ACT-01: Action framework supports multiple action sources
- ACT-04: Agent can request an action based on diagnosis
- ACT-05: Action parameters are validated before execution
- ACT-06: Action execution result is tracked
- ACT-07: All actions are recorded in audit log
- SAF-01: Kill switch can halt all pending/in-progress actions
- SAF-02: Observe-only mode disables all action execution

**Success Criteria:**
1. Action proposal can be created with typed parameters and stored in database
2. Agent discovers available actions from subject at runtime (no hard-coded subject logic in core)
3. Kill switch immediately halts all pending actions
4. Observe-only mode flag prevents any action execution
5. All action lifecycle events (proposed, validated, executed, completed/failed) are recorded in audit log

---

### Phase 13: TiKV Subject Actions

**Goal**: TiKV subject can execute leader transfer, peer transfer, and store drain operations via PD API.
**Depends on**: Phase 12 (action foundation must exist)
**Plans**: 1 plan

Plans:
- [x] 13-01-PLAN.md — PD API methods and TiKV action implementations

**Requirements:**
- ACT-02: Subject can define domain-specific actions
- TKV-01: TiKV subject defines transfer-leader action
- TKV-02: TiKV subject defines transfer-peer action
- TKV-03: TiKV subject defines drain-store action

**Success Criteria:**
1. Agent can execute transfer-leader action that moves region leader to specified store
2. Agent can execute transfer-peer action that moves region replica to different store
3. Agent can execute drain-store action that evicts all leaders from a store
4. Each action validates target exists and is in valid state before execution

---

### Phase 14: Approval Workflow

**Goal**: Configurable approval gate for action execution (default: autonomous).
**Depends on**: Phase 13 (actions must exist to approve)
**Plans**: 2 plans

Plans:
- [x] 14-01-PLAN.md — Approval infrastructure (database schema, ActionDB methods)
- [x] 14-02-PLAN.md — Approval gate in executor and CLI commands

**Requirements:**
- APR-01: Action approval is configurable (on/off, default off)
- APR-02: When approval enabled, user can approve/reject via CLI

**Success Criteria:**
1. Approval mode is configurable via config (default: off — agent executes autonomously)
2. With approval off, agent executes actions immediately after validation
3. With approval on, actions remain pending until human approves
4. User can approve/reject pending actions via CLI when approval is enabled

---

### Phase 15: Workflow Actions

**Goal**: Agent can chain actions, schedule follow-ups, and retry failures.
**Depends on**: Phase 14 (approval workflow must exist for multi-action approval)
**Plans**: 5 plans

Plans:
- [x] 15-01-PLAN.md — Schema and types for workflows, scheduling, retry
- [x] 15-02-PLAN.md — ActionDB workflow and scheduling methods
- [x] 15-03-PLAN.md — Retry configuration and executor workflow methods
- [x] 15-04-PLAN.md — Agent runner integration for scheduled/retry actions
- [x] 15-05-PLAN.md — General tools (wait, log_message) for ACT-03

**Requirements:**
- ACT-03: Agent can use general tools beyond subject-defined actions
- WRK-01: Agent can chain multiple actions into a workflow
- WRK-02: Agent can schedule follow-up actions
- WRK-03: Agent can retry failed actions with backoff

**Success Criteria:**
1. Agent can propose a sequence of actions as a single workflow
2. Agent can schedule a verification action to run after specified delay
3. Failed action retries automatically with exponential backoff (configurable limit)

---

## Milestone Summary

**Key Decisions:**
- Pydantic BaseModel for action types (validation + serialization)
- Separate ACTIONS_SCHEMA_SQL for schema modularity
- Default to OBSERVE mode (safe by default, explicit opt-in for execution)
- Kill switch cancels pending AND switches to OBSERVE mode
- Fire-and-forget action semantics for PD API calls
- Five separate columns for approval state (complete audit trail)
- Global approval mode only (no per-action configuration yet)
- RetryConfig uses dataclass for simplicity
- Tools use same ActionDefinition model with action_type=ActionType.TOOL

**Issues Resolved:**
- Circular imports in safety.py and executor.py via lazy imports
- Schema migrations for existing databases via try/except ALTER TABLE pattern
- ActionType.TOOL support in executor via execute_tool dispatcher

**Issues Deferred:**
- Dry-run mode (DRY-01, DRY-02)
- Risk-tiered approvals (APR-03)
- Blast radius limits (SAF-04)
- Action rate limiting (SAF-05)

**Technical Debt Incurred:**
- None significant

---

*For current project status, see .planning/ROADMAP.md*
