# Requirements: Operator v2.1 (Archived)

**Defined:** 2026-01-26
**Completed:** 2026-01-27
**Core Value:** AI demonstrates real diagnostic reasoning about distributed systems â€” proving the abstraction works for novel, out-of-distribution systems.

## v2.1 Requirements (All Complete)

### Core Abstraction

- [x] **CORE-01**: Subject Protocol uses generic types, not TiKV-specific types
- [x] **CORE-02**: MonitorLoop accepts any Subject implementing InvariantCheckerProtocol
- [x] **CORE-03**: CLI supports --subject flag to select subject type
- [x] **CORE-04**: TiKV-specific types moved from operator-core to operator-tikv
- [x] **CORE-05**: TiKV subject works unchanged after refactoring

### Rate Limiter Service

- [x] **RLSVC-01**: Rate limiter runs as 3+ containerized nodes sharing Redis state
- [x] **RLSVC-02**: Sliding window counter implemented with atomic Lua scripts
- [x] **RLSVC-03**: HTTP management API exposes node list, counters, and limits
- [x] **RLSVC-04**: Prometheus metrics exported from each node
- [x] **RLSVC-05**: Docker Compose environment with Redis, nodes, Prometheus

### operator-ratelimiter Package

- [x] **RLPKG-01**: RateLimiterSubject implements Subject Protocol
- [x] **RLPKG-02**: RateLimiterClient for HTTP management API calls
- [x] **RLPKG-03**: RedisClient for direct state inspection
- [x] **RLPKG-04**: RateLimiterInvariantChecker implements InvariantCheckerProtocol

### Monitoring & Invariants

- [x] **MON-01**: Detect node unreachable (rate limiter node down)
- [x] **MON-02**: Detect Redis disconnected (backend unavailable)
- [x] **MON-03**: Detect high latency (P99 > threshold)
- [x] **MON-04**: Detect counter drift (nodes disagree on count for same key)
- [x] **MON-05**: Detect ghost allowing (actual allowed > configured limit)

### Actions

- [x] **ACT-01**: Reset counter (clear rate limit state for a key)
- [x] **ACT-02**: Update limit (change rate limit configuration)

### Demo & Validation

- [x] **DEMO-01**: Load generator creates realistic traffic patterns
- [x] **DEMO-02**: Chaos injection causes counter drift anomaly
- [x] **DEMO-03**: Chaos injection causes ghost allowing anomaly
- [x] **DEMO-04**: AI diagnosis identifies root cause without rate-limiter-specific prompts

## Summary

| Category | Requirements | Complete |
|----------|-------------|----------|
| Core Abstraction | 5 | 5 |
| Rate Limiter Service | 5 | 5 |
| operator-ratelimiter | 4 | 4 |
| Monitoring & Invariants | 5 | 5 |
| Actions | 2 | 2 |
| Demo & Validation | 4 | 4 |
| **Total** | **25** | **25** |

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| CORE-01 | Phase 16 | Complete |
| CORE-02 | Phase 16 | Complete |
| CORE-03 | Phase 16 | Complete |
| CORE-04 | Phase 16 | Complete |
| CORE-05 | Phase 16 | Complete |
| RLSVC-01 | Phase 17 | Complete |
| RLSVC-02 | Phase 17 | Complete |
| RLSVC-03 | Phase 17 | Complete |
| RLSVC-04 | Phase 17 | Complete |
| RLSVC-05 | Phase 18 | Complete |
| RLPKG-01 | Phase 19 | Complete |
| RLPKG-02 | Phase 19 | Complete |
| RLPKG-03 | Phase 19 | Complete |
| RLPKG-04 | Phase 19 | Complete |
| MON-01 | Phase 19 | Complete |
| MON-02 | Phase 19 | Complete |
| MON-03 | Phase 19 | Complete |
| MON-04 | Phase 19 | Complete |
| MON-05 | Phase 19 | Complete |
| ACT-01 | Phase 19 | Complete |
| ACT-02 | Phase 19 | Complete |
| DEMO-01 | Phase 18 | Complete |
| DEMO-02 | Phase 20 | Complete |
| DEMO-03 | Phase 20 | Complete |
| DEMO-04 | Phase 20 | Complete |

---
*Archived: 2026-01-27*
