# Roadmap: v3.2 Evaluation Harness

**Phases:** 35-39 (5 phases)
**Requirements:** 30 total
**Coverage:** 30/30 (100%)

## Overview

Build eval/ — a standalone harness that injects chaos, monitors agent problem-solving, grades performance, and provides historical analysis. Start with runner infrastructure and TiKV subject with node_kill chaos, add post-hoc scoring and comparison tools, provide CLI and web viewers for browsing results, expand to multiple chaos types with batch campaigns, and finally add config variants for testing different agent configurations.

## Phases

### Phase 35: Runner Layer
**Goal**: Developer can run single-trial evaluations and see raw results stored in database

**Depends on**: Nothing (first phase of v3.2)

**Requirements**: RUN-01, RUN-02, RUN-03, RUN-04, RUN-05, RUN-06, SUBJ-01, SUBJ-02, SUBJ-03, CLI-01, CLI-02

**Success Criteria** (what must be TRUE):
  1. Developer can run `eval run --subject tikv --chaos node_kill` and trial executes (reset → inject → wait → record)
  2. Developer can run `eval run --baseline` and trial executes without agent
  3. Trial data persists in eval.db with timing data (started_at, chaos_injected_at, ticket_created_at, resolved_at, ended_at)
  4. Trial data includes subject state before/after chaos and commands extracted from agent session
  5. TiKVEvalSubject implements EvalSubject protocol and can reset environment via Docker Compose

**Plans**: TBD

Plans:
- [ ] 35-01: TBD
- [ ] 35-02: TBD

---

### Phase 36: Analysis Layer
**Goal**: Developer can compute scores and compare performance across trials/campaigns

**Depends on**: Phase 35

**Requirements**: ANAL-01, ANAL-02, ANAL-03, ANAL-04, ANAL-05, ANAL-06, CLI-04, CLI-05, CLI-06

**Success Criteria** (what must be TRUE):
  1. Developer can run `eval analyze <campaign_id>` and see time-to-detect, time-to-resolve scores
  2. Developer can run `eval compare-baseline <campaign_id>` and see agent performance vs self-healing
  3. Developer can run `eval compare <campaign_a> <campaign_b>` and see performance differences
  4. Analysis computes command metrics (count, unique commands, thrashing detection, destructive commands)
  5. Analysis is idempotent — can re-run on old campaigns without changing data

**Plans**: TBD

Plans:
- [ ] 36-01: TBD
- [ ] 36-02: TBD

---

### Phase 37: Viewer Layer
**Goal**: Developer can browse campaigns and drill into trial details via CLI and web UI

**Depends on**: Phase 36

**Requirements**: VIEW-01, VIEW-02, VIEW-03, VIEW-04, VIEW-05

**Success Criteria** (what must be TRUE):
  1. Developer can run `eval list` and see all campaigns
  2. Developer can run `eval show <campaign_id>` and see campaign summary with trial list
  3. Developer can run `eval show <trial_id>` and see single trial detail
  4. Developer can open web UI (FastAPI + htmx) and browse campaigns/trials
  5. Web UI displays trial reasoning and commands from agent session

**Plans**: TBD

Plans:
- [ ] 37-01: TBD
- [ ] 37-02: TBD

---

### Phase 38: Chaos Expansion
**Goal**: Developer can run batch campaigns with multiple chaos types for comprehensive testing

**Depends on**: Phase 37

**Requirements**: SUBJ-04, SUBJ-05, SUBJ-06, CLI-03

**Success Criteria** (what must be TRUE):
  1. TiKV supports latency chaos (tc netem injection)
  2. TiKV supports disk pressure chaos (fallocate)
  3. TiKV supports network partition chaos (iptables)
  4. Developer can define campaign config YAML specifying multiple trials with different chaos types
  5. Developer can run `eval run campaign config.yaml` and batch campaign executes all trials

**Plans**: TBD

Plans:
- [ ] 38-01: TBD
- [ ] 38-02: TBD

---

### Phase 39: Config Variants
**Goal**: Developer can test different agent configurations and compare their performance

**Depends on**: Phase 38

**Requirements**: CONF-01, CONF-02, CONF-03

**Success Criteria** (what must be TRUE):
  1. Config variants define model, system_prompt, and tools_config
  2. Campaign config YAML can specify which variant to use
  3. Analysis commands compare performance across variants (e.g., Haiku vs Sonnet, different prompts)
  4. Developer can see which configuration performs best for specific chaos types

**Plans**: TBD

Plans:
- [ ] 39-01: TBD

---

## Progress

**Execution Order:**
Phases execute in numeric order: 35 → 36 → 37 → 38 → 39

| Phase | Plans Complete | Status | Completed |
|-------|----------------|--------|-----------|
| 35. Runner Layer | 0/TBD | Not started | - |
| 36. Analysis Layer | 0/TBD | Not started | - |
| 37. Viewer Layer | 0/TBD | Not started | - |
| 38. Chaos Expansion | 0/TBD | Not started | - |
| 39. Config Variants | 0/TBD | Not started | - |

---
*Roadmap created: 2026-01-29*
